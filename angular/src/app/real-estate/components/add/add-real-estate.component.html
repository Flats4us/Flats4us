<div class="container-title">
	<h1 class="text-4xl p-4 font-semibold">Kreator nieruchomości</h1>
</div>
<mat-card class="add-real-estate">
	<mat-stepper #stepper linear>
		<div class="box">
			<mat-step [stepControl]="addRealEstateFormAddressData">
				<ng-template matStepLabel
					><span class="step-label">Dane adresowe</span></ng-template
				>
				<form class="container-form" [formGroup]="addRealEstateFormAddressData">
					<div class="subtitle"></div>
					<mat-form-field appearance="fill">
						<mat-label>Rodzaj nieruchomości</mat-label>
						<span matPrefix>
							<div class="box-icon"><mat-icon>home</mat-icon></div>
						</span>
						<mat-select id="propertyType" formControlName="propertyType">
							<mat-option
								*ngFor="let property of this.realEstateService.properties"
								[value]="property.value"
							>
								{{ property.viewValue }}
							</mat-option>
						</mat-select>
						<mat-error
							*ngIf="addRealEstateFormAddressData.controls['propertyType'].errors?.['required']"
							class="error-text"
						>
							Nie wybrano rodzaju nieruchomości!
						</mat-error>
					</mat-form-field>
					<div class="subtitle-map">
						Dane adresowe:
						<button
							id="showMap"
							class="batch"
							type="button"
							mat-icon-button
							matTooltip="Pokaż mapę"
							aria-label="ShowMap"
							(click)="showMap()"
						>
							<mat-icon>map</mat-icon>
						</button>
					</div>
					<div class="subtitle"></div>
					<mat-form-field appearance="fill">
						<mat-label>Województwo</mat-label>
						<span matPrefix>
							<div class="box-icon"><mat-icon>location_on</mat-icon></div>
						</span>
						<mat-select id="region" formControlName="province">
							<mat-option
								*ngFor="let region of this.realEstateService.regions"
								[value]="region"
							>
								{{ region }}
							</mat-option>
						</mat-select>
						<mat-error
							*ngIf="addRealEstateFormAddressData.controls['province'].errors?.['required']"
							class="error-text"
						>
							Nie wybrano województwa!
						</mat-error>
					</mat-form-field>
					<div class="subtitle"></div>
					<mat-form-field appearance="fill">
						<mat-label>Miejscowość</mat-label>
						<input
							id="city"
							type="text"
							placeholder="Miejscowość"
							aria-label="City"
							matInput
							formControlName="city"
							[matAutocomplete]="autoCity"
						/>
						<span matPrefix>
							<div class="box-icon"><mat-icon>location_on</mat-icon></div>
						</span>
						<mat-autocomplete #autoCity="matAutocomplete">
							<mat-optgroup
								*ngFor="let group of citiesGroupOptions$ | async"
								[label]="group.whole"
							>
								<mat-option *ngFor="let city of group.parts" [value]="city">
									{{ city }}
								</mat-option>
							</mat-optgroup>
						</mat-autocomplete>
						<mat-error
							*ngIf="addRealEstateFormAddressData.controls['city'].errors?.['required']"
							class="error-text"
						>
							Nie wybrano miejscowości!
						</mat-error>
					</mat-form-field>
					<div class="subtitle"></div>
					<mat-form-field appearance="fill">
						<mat-label>Dzielnica</mat-label>
						<input
							id="district"
							type="text"
							placeholder="Dzielnica"
							aria-label="District"
							matInput
							formControlName="district"
							[matAutocomplete]="autoDistrict"
						/>
						<span matPrefix>
							<div class="box-icon"><mat-icon>location_on</mat-icon></div>
						</span>
						<mat-autocomplete #autoDistrict="matAutocomplete">
							<mat-optgroup
								*ngFor="let group2 of districtGroupOptions$ | async"
								[label]="group2.whole"
							>
								<mat-option *ngFor="let district of group2.parts" [value]="district">
									{{ district }}
								</mat-option>
							</mat-optgroup>
						</mat-autocomplete>
					</mat-form-field>
					<div class="subtitle"></div>
					<mat-form-field appearance="fill">
						<mat-label>Kod pocztowy</mat-label>
						<span matPrefix>
							<div class="box-icon"><mat-icon>location_on</mat-icon></div>
						</span>
						<input
							id="postalCode"
							formControlName="postalCode"
							type="text"
							placeholder="Kod pocztowy w formacie XX-XXX"
							aria-label="PostalCode"
							matInput
						/>
						<mat-error
							*ngIf="addRealEstateFormAddressData.controls['postalCode'].errors?.['required']"
							class="error-text"
						>
							Nie podano kodu pocztowego!
						</mat-error>
						<mat-error
							*ngIf="addRealEstateFormAddressData.controls['postalCode'].errors?.['pattern']"
							class="error-text"
						>
							Nieprawidłowy format kodu pocztowego!
						</mat-error>
					</mat-form-field>
					<div class="subtitle"></div>
					<mat-form-field appearance="fill">
						<mat-label>Ulica</mat-label>
						<span matPrefix>
							<div class="box-icon"><mat-icon>location_on</mat-icon></div>
						</span>
						<input
							id="street"
							formControlName="street"
							type="text"
							placeholder="Ulica"
							aria-label="Street"
							matInput
						/>
						<mat-error
							*ngIf="addRealEstateFormAddressData.controls['street'].errors?.['required']"
							class="error-text"
						>
							Nie podano nazwy ulicy!
						</mat-error>
					</mat-form-field>
					<div class="subtitle"></div>
					<mat-form-field appearance="fill">
						<mat-label>Numer ulicy</mat-label>
						<span matPrefix>
							<div class="box-icon"><mat-icon>location_on</mat-icon></div>
						</span>
						<input
							id="streetNumber"
							formControlName="number"
							type="text"
							placeholder="Numer ulicy"
							aria-label="StreetNumber"
							matInput
						/>
						<mat-error
							*ngIf="addRealEstateFormAddressData.controls['number'].errors?.['required']"
							class="error-text"
						>
							Nie podano numeru ulicy!
						</mat-error>
					</mat-form-field>
					<div class="subtitle"></div>
					<mat-form-field appearance="fill">
						<mat-label>Numer mieszkania</mat-label>
						<span matPrefix>
							<div class="box-icon"><mat-icon>location_on</mat-icon></div>
						</span>
						<input
							id="flatNumber"
							formControlName="flat"
							type="text"
							placeholder="Numer mieszkania"
							aria-label="FlatNumber"
							matInput
						/>
						<mat-error
							*ngIf="addRealEstateFormAddressData.controls['flat'].errors?.['required']"
							class="error-text"
						>
							Nie podano numeru mieszkania!
						</mat-error>
						<mat-error
							*ngIf="addRealEstateFormAddressData.controls['flat'].errors?.['pattern']"
							class="error-text"
						>
							Nieprawidłowy numer mieszkania!
						</mat-error>
					</mat-form-field>
					<div class="button-box">
						<button
							mat-raised-button
							matStepperNext
							color="primary"
							[disabled]="!addRealEstateFormAddressData.valid"
						>
							Następny <mat-icon iconPositionEnd>arrow_forward_ios</mat-icon>
						</button>
					</div>
				</form>
			</mat-step>
		</div>
		<div class="box">
			<mat-step [stepControl]="addRealEstateFormRemainingData">
				<ng-template matStepLabel
					><span class="step-label">Pozostałe dane</span></ng-template
				>
				<form class="container-form" [formGroup]="addRealEstateFormRemainingData">
					<div class="subtitle"></div>
					<mat-form-field appearance="fill">
						<mat-label>Powierzchnia</mat-label>
						<span matPrefix>
							<div class="box-icon"><mat-icon>straighten</mat-icon></div>
						</span>
						<input
							id="area"
							formControlName="area"
							type="number"
							placeholder="Powierzchnia"
							aria-label="area"
							matInput
						/>
						<span matSuffix class="suffix">m²</span>
						<mat-error
							*ngIf="addRealEstateFormRemainingData.controls['area'].errors?.['required']"
							class="error-text"
						>
							Nie podano powierzchni!
						</mat-error>
						<mat-error
							*ngIf="addRealEstateFormRemainingData.controls['area'].errors?.['min']"
							class="error-text"
						>
							Nieprawidłowa wartość!
						</mat-error>
					</mat-form-field>
					<div class="subtitle"></div>
					<mat-form-field appearance="fill">
						<mat-label>Powierzchnia działki</mat-label>
						<span matPrefix>
							<div class="box-icon"><mat-icon>straighten</mat-icon></div>
						</span>
						<input
							id="plotArea"
							formControlName="plotArea"
							type="number"
							placeholder="Powierzchnia działki"
							aria-label="plotArea"
							matInput
						/>
						<span matSuffix class="suffix">m²</span>
						<mat-error
							*ngIf="addRealEstateFormRemainingData.controls['plotArea'].errors?.['required']"
							class="error-text"
						>
							Nie podano powierzchni działki!
						</mat-error>
						<mat-error
							*ngIf="addRealEstateFormRemainingData.controls['plotArea'].errors?.['min']"
							class="error-text"
						>
							Nieprawidłowa wartość!
						</mat-error>
					</mat-form-field>
					<div class="subtitle"></div>
					<mat-form-field appearance="fill">
						<mat-label>Maks. l. mieszkańców</mat-label>
						<span matPrefix>
							<div class="box-icon"><mat-icon>supervisor_account</mat-icon></div>
						</span>
						<input
							id="maxNumberOfInhabitants"
							formControlName="maxNumberOfInhabitants"
							type="number"
							placeholder="Maks. l. mieszkańców"
							aria-label="MaxNumberOfInhabitants"
							matInput
						/>
						<mat-error
							*ngIf="addRealEstateFormRemainingData.controls['maxNumberOfInhabitants'].errors?.['required']"
							class="error-text"
						>
							Nie podano maks. l. mieszkańców!
						</mat-error>
						<mat-error
							*ngIf="addRealEstateFormRemainingData.controls['maxNumberOfInhabitants'].errors?.['min']"
							class="error-text"
						>
							Nieprawidłowa wartość!
						</mat-error>
					</mat-form-field>
					<mat-form-field appearance="fill">
						<mat-label>Rok budowy</mat-label>
						<span matPrefix>
							<div class="box-icon"><mat-icon>history</mat-icon></div>
						</span>
						<input
							id="constructionYear"
							formControlName="constructionYear"
							type="number"
							placeholder="Rok budowy"
							aria-label="ConstructionYear"
							matInput
						/>
						<mat-error
							*ngIf="addRealEstateFormRemainingData.controls['constructionYear'].errors?.['required']"
							class="error-text"
						>
							Nie podano roku budowy!
						</mat-error>
						<mat-error
							*ngIf="addRealEstateFormRemainingData.controls['constructionYear'].errors?.['pattern'] ||
							addRealEstateFormRemainingData.controls['constructionYear'].errors?.['min'] ||
							addRealEstateFormRemainingData.controls['constructionYear'].errors?.['max']"
							class="error-text"
						>
							Nieprawidłowa wartość!
						</mat-error>
					</mat-form-field>
					<div class="subtitle"></div>
					<mat-form-field appearance="fill">
						<mat-label>Liczba pokoi</mat-label>
						<span matPrefix>
							<div class="box-icon"><mat-icon>meeting_room</mat-icon></div>
						</span>
						<input
							id="numberOfRooms"
							formControlName="numberOfRooms"
							type="number"
							placeholder="Liczba pokoi"
							aria-label="NumberOfRooms"
							matInput
						/>
						<mat-error
							*ngIf="addRealEstateFormRemainingData.controls['numberOfRooms'].errors?.['required']"
							class="error-text"
						>
							Nie podano liczby pokoi!
						</mat-error>
						<mat-error
							*ngIf="addRealEstateFormRemainingData.controls['numberOfRooms'].errors?.['min']"
							class="error-text"
						>
							Nieprawidłowa wartość!
						</mat-error>
					</mat-form-field>
					<div class="subtitle"></div>
					<mat-form-field appearance="fill">
						<mat-label>Piętro</mat-label>
						<span matPrefix>
							<div class="box-icon"><mat-icon>location_city</mat-icon></div>
						</span>
						<input
							id="floor"
							formControlName="floor"
							type="number"
							placeholder="Piętro"
							aria-label="Floor"
							matInput
						/>
						<mat-error
							*ngIf="addRealEstateFormRemainingData.controls['floor'].errors?.['required']"
							class="error-text"
						>
							Nie podano piętra!
						</mat-error>
						<mat-error
							*ngIf="addRealEstateFormRemainingData.controls['floor'].errors?.['min']"
							class="error-text"
						>
							Nieprawidłowa wartość!
						</mat-error>
					</mat-form-field>
					<div class="subtitle"></div>
					<mat-form-field appearance="fill">
						<mat-label>Liczba pięter</mat-label>
						<span matPrefix>
							<div class="box-icon"><mat-icon>location_city</mat-icon></div>
						</span>
						<input
							id="numberOfFloors"
							formControlName="numberOfFloors"
							type="number"
							placeholder="Liczba pięter"
							aria-label="NumberOfFloors"
							matInput
						/>
						<mat-error
							*ngIf="addRealEstateFormRemainingData.controls['numberOfFloors'].errors?.['required']"
							class="error-text"
						>
							Nie podano liczby pięter!
						</mat-error>
						<mat-error
							*ngIf="addRealEstateFormRemainingData.controls['numberOfFloors'].errors?.['min']"
							class="error-text"
						>
							Nieprawidłowa wartość!
						</mat-error>
					</mat-form-field>
					<div class="subtitle"></div>
					<mat-form-field appearance="fill">
						<mat-label>Wyposażenie</mat-label>
						<span matPrefix>
							<div class="box-icon"><mat-icon>category</mat-icon></div>
						</span>
						<mat-select id="equipment" formControlName="equipment" multiple>
							<mat-option
								*ngFor="let equipment of this.realEstateService.equipment"
								[value]="equipment"
							>
								{{ equipment.name }}
							</mat-option>
						</mat-select>
					</mat-form-field>
					<div class="button-box">
						<button mat-raised-button matStepperPrevious color="primary">
							Poprzedni <mat-icon>arrow_back_ios</mat-icon>
						</button>
						<div class="btn-spacer"></div>
						<button
							mat-raised-button
							matStepperNext
							color="primary"
							[disabled]="!addRealEstateFormRemainingData.valid"
						>
							Następny <mat-icon iconPositionEnd>arrow_forward_ios</mat-icon>
						</button>
					</div>
				</form>
			</mat-step>
		</div>
		<div class="box">
			<mat-step [stepControl]="addRealEstateFormPhotos">
				<ng-template matStepLabel
					><span class="step-label">Zdjęcia</span></ng-template
				>
				<form [formGroup]="addRealEstateFormPhotos">
					<div class="button-box-function">
						<div class="gallery">
							<img *ngFor="let url of urls" class="img" [src]="url" />
						</div>
						<input
							#fileUpload
							id="file"
							class="file-input"
							type="file"
							accept="image/*"
							multiple
							formControlName="photos"
							aria-label="File"
							(change)="onFileSelected($event)"
						/>
						<div *ngIf="addRealEstateFormPhotos.get('photos')?.hasError('required')">
							Zdjęcie jest wymagane.
						</div>
						<div class="batch">
							<div class="desctext">
								{{ fileName || "Dodaj zdjęcia (max 10)" }}
							</div>

							<button
								mat-mini-fab
								color="primary"
								id="upload"
								aria-label="Upload"
								(click)="fileUpload.click()"
							>
								<mat-icon>attach_file</mat-icon>
							</button>
						</div>
						<div class="button-box">
							<button mat-raised-button color="primary" matStepperPrevious>
								Poprzedni <mat-icon>arrow_back_ios</mat-icon>
							</button>
							<div class="btn-spacer"></div>
							<button
								mat-raised-button
								color="primary"
								matStepperNext
								[disabled]="!addRealEstateFormPhotos.valid"
							>
								Następny <mat-icon iconPositionEnd>arrow_forward_ios</mat-icon>
							</button>
						</div>
					</div>
				</form>
			</mat-step>
		</div>
		<div class="box">
			<mat-step [completed]="completed">
				<ng-template *ngIf="completed" matStepLabel
					><span class="step-label">Gotowe</span></ng-template
				>
				<div class="button-box-function">
					<div
						*ngIf="
							addRealEstateFormAddressData.valid &&
							addRealEstateFormRemainingData.valid &&
							addRealEstateFormPhotos.valid
						"
						class="button-box-function"
					>
						<mat-icon class="success-icon" [inline]="true"> insert_emoticon</mat-icon>
						<h2>Formularz został pomyślnie wypełniony!</h2>
						<h2>
							Klikająć na przycisk "Zapisz nieruchomość" potwierdzasz prawdziwość
							wprowadzonych danych.
						</h2>
					</div>
					<div class="button-box">
						<button
							*ngIf="!completed"
							mat-raised-button
							color="primary"
							matStepperPrevious
						>
							Poprzedni <mat-icon>arrow_back_ios</mat-icon>
						</button>
						<button
							*ngIf="completed"
							mat-raised-button
							color="primary"
							(click)="onReturn()"
						>
							Powrót <mat-icon>arrow_back_ios</mat-icon>
						</button>
						<div class="btn-spacer"></div>
						<button
							*ngIf="
								addRealEstateFormAddressData.valid &&
								addRealEstateFormRemainingData.valid &&
								addRealEstateFormPhotos.valid
							"
							id="addRealEstate"
							type="submit"
							mat-raised-button
							color="primary"
							aria-label="AddRealEstate"
							(click)="saveRealEstate()"
						>
							Zapisz nieruchomość
						</button>
						<div class="btn-spacer"></div>
						<button
							mat-raised-button
							color="primary"
							[disabled]="completed"
							(click)="formReset()"
						>
							Reset
						</button>
					</div>
					<h2 *ngIf="completed" class="subtitle-desc">
						<p>Nieruchomość została zapisana!</p>
						<p>Czy chcesz dodać ofertę dla zapisanej nieruchomości?</p>
					</h2>
					<div class="button-box">
						<button
							*ngIf="completed"
							id="addOffer"
							type="button"
							mat-raised-button
							color="primary"
							aria-label="AddOffer"
							(click)="addOffer()"
						>
							Dodaj ofertę
						</button>
					</div>
				</div>
			</mat-step>
		</div>
	</mat-stepper>
</mat-card>
