<mat-card
	*ngIf="{
		currentUser: currentUser$ | async,
		messagesHistory: messages$ | async,
		groupChatId: groupChatId$ | async
	} as data"
>
	<div class="conversation-header">
		<div></div>
		<button mat-icon-button [matMenuTriggerFor]="menu">
			<mat-icon>more_vert</mat-icon>
		</button>
		<mat-menu #menu="matMenu">
			<button mat-menu-item>
				<mat-icon>close</mat-icon>
				<span>{{ "Disputes.end-dispute" | translate }}</span>
			</button>
			<button mat-menu-item>
				<mat-icon>add</mat-icon>
				<span>{{ "Disputes.add-moderate" | translate }}</span>
			</button>
		</mat-menu>
	</div>
	<div
		*ngIf="data.currentUser && data.messagesHistory"
		class="conversation-list"
	>
		<div
			*ngFor="let message of data.messagesHistory; let index = index"
			class="flex"
		>
			<div
				class="conversation"
				[class]="
					message.senderId === data.currentUser.userId
						? 'conversation-sent'
						: 'conversation-received'
				"
			>
				<span *ngIf="message.senderId === data.currentUser.userId">{{
					data.currentUser.name
				}}</span>
				<span class="bubble">{{ message.content }}</span>
			</div>
		</div>
		<div *ngFor="let msg of messages; let index = index" class="flex">
			<div
				class="conversation"
				[class]="
					msg.user === data.currentUser.userId
						? 'conversation-sent'
						: 'conversation-received'
				"
			>
				<span *ngIf="msg.user === data.currentUser.userId">{{
					data.currentUser.name
				}}</span>
				<span class="bubble">{{ msg.message }}</span>
			</div>
		</div>
	</div>
	<mat-form-field
		*ngIf="data.currentUser?.userId && data.groupChatId"
		class="w-full"
	>
		<input
			matInput
			type="text"
			placeholder="{{ 'Conversation.message' | translate }}..."
			[formControl]="messageControl"
			(keydown.enter)="onSend(data.groupChatId, data.currentUser!.userId)"
		/>
		<button
			matSuffix
			mat-icon-button
			(click)="onSend(data.groupChatId, data.currentUser!.userId)"
		>
			<mat-icon>send</mat-icon>
		</button>
	</mat-form-field>
</mat-card>
