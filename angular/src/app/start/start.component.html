<div *ngIf="flatOptions$ | async as flatOptions" class="startsite">
	<form class="container-4" [formGroup]="startSiteForm" (ngSubmit)="onSubmit()">
		<div class="container-3">
			<h1 class="text-4xl p-4 font-semibold">
				Znajdź mieszkanie, pokój lub dom do wynajęcia
			</h1>
		</div>
		<div class="container">
			<div class="box-2">
				<mat-form-field appearance="fill">
					<mat-label>Województwo</mat-label>
					<span matPrefix>
						<div class="box-icon"><mat-icon>location_on</mat-icon></div>
					</span>
					<mat-select id="region" formControlName="regionsGroup">
						<mat-option
							*ngFor="let region of this.realEstateService.regions"
							[value]="region"
						>
							{{ region }}
						</mat-option>
					</mat-select>
					<mat-error
						*ngIf="startSiteForm.controls['regionsGroup'].errors?.['required']"
						class="error-text"
					>
						Nie wybrano województwa!
					</mat-error>
				</mat-form-field>

				<mat-form-field appearance="fill">
					<mat-label>Miejscowość</mat-label>
					<input
						id="city"
						type="text"
						placeholder="Miejscowość"
						aria-label="City"
						matInput
						formControlName="citiesGroup"
						[matAutocomplete]="autoCity"
					/>
					<span matPrefix>
						<div class="box-icon"><mat-icon>location_on</mat-icon></div>
					</span>
					<mat-autocomplete #autoCity="matAutocomplete">
						<mat-optgroup
							*ngFor="let group of citiesGroupOptions$ | async"
							[label]="group.whole"
						>
							<mat-option *ngFor="let city of group.parts" [value]="city">
								{{ city }}
							</mat-option>
						</mat-optgroup>
					</mat-autocomplete>
					<mat-error
						*ngIf="startSiteForm.controls['citiesGroup'].errors?.['required']"
						class="error-text"
					>
						Nie wybrano miasta!
					</mat-error>
				</mat-form-field>

				<mat-form-field appearance="fill">
					<mat-label>Odległość</mat-label>
					<span matPrefix>
						<div class="box-icon"><mat-icon>directions_walk</mat-icon></div>
					</span>
					<mat-select id="distance" formControlName="distance">
						<mat-option
							*ngFor="let distance of this.realEstateService.distances"
							[value]="distance.value"
						>
							{{ distance.viewValue }}
						</mat-option>
					</mat-select>
				</mat-form-field>

				<mat-form-field appearance="fill">
					<mat-label>Rodzaj nieruchomości</mat-label>
					<span matPrefix>
						<div class="box-icon"><mat-icon>home</mat-icon></div>
					</span>
					<mat-select id="property" formControlName="property" multiple>
						<mat-option
							*ngFor="let property of this.realEstateService.properties"
							[value]="property"
						>
							{{ property }}
						</mat-option>
					</mat-select>
					<mat-error
						*ngIf="startSiteForm.controls['property'].errors?.['required']"
						class="error-text"
					>
						Nie wybrano nieruchomości!
					</mat-error>
				</mat-form-field>

				<mat-form-field appearance="fill">
					<mat-label>Cena min.</mat-label>
					<span matPrefix>
						<div class="box-icon"><mat-icon>attach_money</mat-icon></div>
					</span>
					<input
						id="minPrice"
						formControlName="minPrice"
						type="number"
						placeholder="Cena min."
						aria-label="MinimalPrice"
						matInput
						[matAutocomplete]="autoPriceMin"
					/>
					<span class="suffix" class="suffix" matSuffix>zł</span>
					<mat-autocomplete #autoPriceMin="matAutocomplete">
						<mat-option
							*ngFor="let price of this.realEstateService.priceMaxs"
							[value]="price.value"
						>
							{{ price.viewValue }}
						</mat-option>
					</mat-autocomplete>
					<mat-error class="error-text"> Nieprawidłowa wartość! </mat-error>
				</mat-form-field>

				<mat-form-field appearance="fill">
					<mat-label>Cena maks.</mat-label>
					<span matPrefix>
						<div class="box-icon"><mat-icon>attach_money</mat-icon></div>
					</span>
					<input
						id="maxPrice"
						formControlName="maxPrice"
						type="number"
						placeholder="Cena maks."
						aria-label="MaximalPrice"
						matInput
						[matAutocomplete]="autoPriceMin"
					/>
					<span class="suffix" matSuffix>zł</span>
					<mat-autocomplete #autoPriceMin="matAutocomplete">
						<mat-option
							*ngFor="let price of this.realEstateService.priceMaxs"
							[value]="price.value"
						>
							{{ price.viewValue }}
						</mat-option>
					</mat-autocomplete>
					<mat-error class="error-text"> Nieprawidłowa wartość! </mat-error>
				</mat-form-field>
				<div class="batch">
					<button
						class="box-icon-2"
						id="showMoreFilters"
						type="button"
						mat-icon-button
						matTooltip="Pokaż więcej filtrów"
						aria-label="ShowMoreFilters"
						(click)="showFilters()"
					>
						<mat-icon>filter_list</mat-icon>
					</button>

					<button
						class="box-icon-2"
						id="showMap"
						type="button"
						mat-icon-button
						matTooltip="Pokaż mapę"
						aria-label="ShowMap"
						(click)="showMap()"
					>
						<mat-icon>map</mat-icon>
					</button>

					<button
						class="box-icon-2"
						id="search"
						type="submit"
						mat-icon-button
						matTooltip="Szukaj ofert"
						aria-label="SearchForOffers"
						[disabled]="!startSiteForm.valid"
					>
						<mat-icon>search</mat-icon>
					</button>
					<button
						class="box-icon-2"
						id="sort"
						mat-icon-button
						matTooltip="Sortuj oferty według"
						aria-label="SortButton"
						[matMenuTriggerFor]="menu"
					>
						<mat-icon>sort</mat-icon>
					</button>
					<mat-menu #menu="matMenu" id="sort">
						<button
							*ngFor="let sortByOption of this.startService.sortByOptions"
							mat-menu-item
							[value]="sortByOption"
							(click)="onSelect(sortByOption)"
						>
							<span>{{ sortByOption.description }}</span>
						</button>
					</mat-menu>
				</div>
			</div>
			<div *ngIf="showMoreFilters" class="box-3">
				<mat-form-field appearance="fill">
					<mat-label>Dzielnica</mat-label>
					<input
						id="district"
						type="text"
						placeholder="Dzielnica"
						aria-label="District"
						matInput
						formControlName="districtsGroup"
						[matAutocomplete]="autoDistrict"
					/>
					<span matPrefix>
						<div class="box-icon"><mat-icon>location_on</mat-icon></div>
					</span>
					<mat-autocomplete #autoDistrict="matAutocomplete">
						<mat-optgroup
							*ngFor="let group2 of districtGroupOptions$ | async"
							[label]="group2.whole"
						>
							<mat-option *ngFor="let district of group2.parts" [value]="district">
								{{ district }}
							</mat-option>
						</mat-optgroup>
					</mat-autocomplete>
				</mat-form-field>

				<mat-form-field appearance="fill">
					<mat-label>Powierzchnia od</mat-label>
					<span matPrefix>
						<div class="box-icon"><mat-icon>straighten</mat-icon></div>
					</span>
					<input
						id="minArea"
						formControlName="minArea"
						type="number"
						placeholder="Powierzchnia od"
						aria-label="MinimalArea"
						matInput
						[matAutocomplete]="autoAreaFrom"
					/>
					<span matSuffix class="suffix">m²</span>
					<mat-autocomplete #autoAreaFrom="matAutocomplete">
						<mat-option
							*ngFor="let area of this.realEstateService.areaFroms"
							[value]="area.value"
						>
							{{ area.viewValue }}
						</mat-option>
					</mat-autocomplete>
					<mat-error class="error-text"> Nieprawidłowa wartość! </mat-error>
				</mat-form-field>

				<mat-form-field appearance="fill">
					<mat-label>Powierzchnia do</mat-label>
					<span matPrefix>
						<div class="box-icon"><mat-icon>straighten</mat-icon></div>
					</span>
					<input
						id="maxArea"
						formControlName="maxArea"
						type="number"
						placeholder="Powierzchnia do"
						aria-label="MaximalArea"
						matInput
						[matAutocomplete]="autoAreaTo"
					/>
					<span matSuffix class="suffix">m²</span>
					<mat-autocomplete #autoAreaTo="matAutocomplete">
						<mat-option
							*ngFor="let area of this.realEstateService.areaTos"
							[value]="area.value"
						>
							{{ area.viewValue }}
						</mat-option>
					</mat-autocomplete>
					<mat-error class="error-text"> Nieprawidłowa wartość! </mat-error>
				</mat-form-field>

				<mat-form-field appearance="fill">
					<mat-label>Lata budowy</mat-label>
					<span matPrefix>
						<div class="box-icon"><mat-icon>history</mat-icon></div>
					</span>
					<mat-select id="year" formControlName="year" multiple>
						<mat-option
							*ngFor="let year of this.realEstateService.yearOfBuilds"
							[value]="year"
						>
							{{ year }}
						</mat-option>
					</mat-select>
				</mat-form-field>

				<mat-form-field appearance="fill">
					<mat-label>Min. liczba pokoi</mat-label>
					<span matPrefix>
						<div class="box-icon"><mat-icon>meeting_room</mat-icon></div>
					</span>
					<input
						id="rooms"
						formControlName="rooms"
						type="number"
						placeholder="Min. liczba pokoi"
						aria-label="NumberOfRooms"
						matInput
						[matAutocomplete]="autoNumberOfRooms"
					/>
					<mat-autocomplete #autoNumberOfRooms="matAutocomplete">
						<mat-option
							*ngFor="let room of this.realEstateService.numberOfRooms"
							[value]="room.value"
						>
							{{ room.viewValue }}
						</mat-option>
					</mat-autocomplete>
					<mat-error class="error-text"> Nieprawidłowa wartość! </mat-error>
				</mat-form-field>

				<mat-form-field appearance="fill">
					<mat-label>Piętro</mat-label>
					<span matPrefix>
						<div class="box-icon"><mat-icon>location_city</mat-icon></div>
					</span>
					<input
						id="floors"
						formControlName="floors"
						type="number"
						placeholder="Piętro"
						aria-label="NumberOfFloors"
						matInput
						[matAutocomplete]="autoNumberOfFloors"
					/>
					<mat-autocomplete #autoNumberOfFloors="matAutocomplete">
						<mat-option
							*ngFor="let floor of this.realEstateService.numberOfFloors"
							[value]="floor.value"
						>
							{{ floor.viewValue }}
						</mat-option>
					</mat-autocomplete>
					<mat-error class="error-text"> Nieprawidłowa wartość! </mat-error>
				</mat-form-field>

				<mat-form-field appearance="fill">
					<mat-label>Wyposażenie</mat-label>
					<span matPrefix>
						<div class="box-icon"><mat-icon>category</mat-icon></div>
					</span>
					<mat-select id="equipment" formControlName="equipment" multiple>
						<mat-option
							*ngFor="let equipment of this.realEstateService.equipment"
							[value]="equipment"
						>
							{{ equipment }}
						</mat-option>
					</mat-select>
				</mat-form-field>
			</div>
		</div>
	</form>
	<div>
		<div class="container-5">
			<div *ngIf="isSubmitted" class="container-3">
				<h1>
					Znaleziono
					<span
						class="colour-text"
						[appGetDescription]="this.startService.allFlatOffers.length"
					></span>
				</h1>
			</div>
			<div *ngIf="!isSubmitted" class="container-3">
				<h1>Promowane <span class="colour-text">oferty</span></h1>
			</div>
		</div>
		<div class="container-2">
			<mat-card
				*ngFor="let flat of flatOptions"
				class="card"
				(click)="navigateToFlat(flat.url)"
			>
				<mat-card-subtitle
					>{{ flat.type }} - {{ flat.regionCity.city }},
					{{ flat.district }}</mat-card-subtitle
				>
				<img mat-card-image class="imgs" alt="Mieszkanie" [src]="flat.imgSource" />
				<mat-card-content matSort>
					<mat-chip-listbox>
						<mat-chip>
							<div class="chip">
								<mat-icon>attach_money</mat-icon>
								<span>Cena: {{ flat.price }} zł/mc</span>
							</div>
						</mat-chip>
						<mat-chip>
							<div class="chip">
								<mat-icon>add</mat-icon><span>Czynsz: {{ flat.rent }} zł/mc</span>
							</div>
						</mat-chip>
						<mat-chip>
							<div class="chip">
								<mat-icon>straighten</mat-icon>
								<span>Powierzchnia: {{ flat.area }} m²</span>
							</div>
						</mat-chip>
						<mat-chip>
							<div class="chip">
								<mat-icon>meeting_room</mat-icon>
								<span>Liczba pokoi: {{ flat.rooms }}</span>
							</div>
						</mat-chip>
						<mat-chip>
							<mat-mini-fab
								class="box-icon-3"
								id="addToFavorite"
								type="button"
								mat-icon-button
								matTooltip="Dodaj do ulubionych"
								aria-label="AddToFavorite"
								(click)="addToFavorite()"
							>
								<mat-icon>favorite_border</mat-icon>
							</mat-mini-fab>
						</mat-chip>
					</mat-chip-listbox>
				</mat-card-content>
			</mat-card>
		</div>
	</div>
	<mat-paginator
		*ngIf="offersLength$ | async as length"
		#paginator
		id="paginator2"
		showFirstLastButtons
		aria-label="Paginator"
		[length]="length"
		[pageSize]="pageSize"
		[pageIndex]="pageIndex"
		[pageSizeOptions]="[6, 12, 18, 48]"
		(page)="changePage($event)"
	>
		>
	</mat-paginator>
</div>
