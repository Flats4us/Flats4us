<div *ngIf="modificationType !== mType.CREATE" class="container-title">
	<h1
		*ngIf="(user$ | async) === uType.STUDENT"
		class="text-4xl p-4 font-semibold"
	>
		Edycja profilu studenta
	</h1>
	<h1 *ngIf="(user$ | async) === uType.OWNER" class="text-4xl p-4 font-semibold">
		Edycja profilu własciciela
	</h1>
</div>
<form
	*ngIf="
		(user$ | async) === uType.STUDENT && (actualStudent$ | async) as student
	"
	[formGroup]="dataFormGroupStudent"
	(ngSubmit)="onSubmit()"
>
	<div class="edit-profile">
		<div class="container-photo">
			<div class="image-box">
				<img class="profile-avatar__image" [src]="urlPhoto" />
				<input
					#photoUpload
					id="file"
					class="file-upload"
					type="file"
					accept="image/*"
					aria-label="File"
					value="urlPhoto"
					(change)="onFileSelected($event, regexImage)"
				/>
				<mat-error *ngIf="!urlPhoto || urlPhoto === urlAvatar" class="error-text"
					>Nie wczytano zdjęcia!</mat-error
				>
				<div class="text-3xl p-4 semibold">
					{{ student.name }} {{ student.surname }}
				</div>
				<div class="text-3xl pb-4 semibold">
					status:
					{{ student.status === sType.VERIFIED ? sType.VERIFIED : sType.UNVERIFIED }}
				</div>
				<div class="text-3xl pb-4 semibold">email: {{ student.email }}</div>
				<div
					*ngIf="modificationType === mType.EDIT && getAge(student.yearOfBirth)"
					class="text-3xl pb-4 semibold"
				>
					wiek {{ getAge(student.yearOfBirth) }}
				</div>
				<div
					*ngIf="
						modificationType === mType.CREATE &&
						getAge(dataFormGroupStudent.get('yearOfBirth')?.value)
					"
					class="text-3xl pb-4 semibold"
				>
					wiek {{ getAge(dataFormGroupStudent.get("yearOfBirth")?.value ?? "") }}
				</div>
				<div class="button-box">
					<button
						mat-raised-button
						color="primary"
						id="upload"
						type="button"
						aria-label="Upload"
						(click)="photoUpload.click()"
					>
						<span *ngIf="modificationType === mType.EDIT">Zmień zdjęcie</span>
						<span *ngIf="modificationType === mType.CREATE">Dodaj zdjęcie</span>
						<mat-icon iconPositionEnd>add_photo_alternate</mat-icon>
					</button>
				</div>
			</div>
		</div>
		<div class="container-inputs">
			<div class="data-container">
				<mat-form-field *ngIf="modificationType === mType.CREATE">
					<mat-label>Rok urodzenia</mat-label>
					<input
						id="yearOfBirth"
						formControlName="yearOfBirth"
						type="text"
						placeholder="Rok urodzenia"
						aria-label="YearOfBirth"
						matInput
					/>
					<mat-error
						*ngIf="dataFormGroupStudent.controls['yearOfBirth'].errors?.['required']"
						class="error-text"
					>
						Nie podano roku urodzenia!
					</mat-error>
					<mat-error
						*ngIf="dataFormGroupStudent.controls['yearOfBirth'].errors?.['pattern'] || 
								dataFormGroupStudent.controls['yearOfBirth'].errors?.['max']"
						class="error-text"
					>
						Nieprawidłowy rok urodzenia!
					</mat-error>
				</mat-form-field>
				<mat-form-field>
					<mat-label>Numer studencki</mat-label>
					<input
						id="indexNumber"
						formControlName="indexNumber"
						type="text"
						placeholder="Numer studencki"
						aria-label="IndexNumber"
						matInput
					/>
					<mat-error
						*ngIf="dataFormGroupStudent.controls['indexNumber'].errors?.['required']"
						class="error-text"
					>
						Nie podano numeru studenta!
					</mat-error>
				</mat-form-field>
				<mat-form-field>
					<mat-label>Uczelnia</mat-label>
					<input
						id="university"
						formControlName="university"
						type="text"
						placeholder="Uczelnia"
						aria-label="University"
						matInput
					/>
					<mat-error
						*ngIf="dataFormGroupStudent.controls['university'].errors?.['required']"
						class="error-text"
					>
						Nie podano nazwy uczelni!
					</mat-error>
				</mat-form-field>
				<mat-form-field>
					<mat-label>Adres zamieszkania</mat-label>
					<input
						id="address"
						formControlName="address"
						type="text"
						placeholder="Adres zamieszkania"
						aria-label="Address"
						matInput
					/>
					<mat-error
						*ngIf="dataFormGroupStudent.controls['address'].errors?.['required']"
						class="error-text"
					>
						Nie podano adresu!
					</mat-error>
				</mat-form-field>
				<mat-form-field>
					<mat-label>Nr telefonu</mat-label>
					<input matInput formControlName="phoneNumber" placeholder="Nr telefonu" />
					<mat-error
						*ngIf="dataFormGroupStudent.controls['phoneNumber'].errors?.['required']"
						class="error-text"
					>
						Nie podano numeru telefonu!
					</mat-error>
					<mat-error
						*ngIf="dataFormGroupStudent.controls['phoneNumber'].errors?.['pattern']"
						class="error-text"
					>
						Nieprawidłowy numer telefonu!
					</mat-error>
				</mat-form-field>
				<mat-form-field>
					<mat-label>Zainteresowania</mat-label>
					<mat-chip-grid #chipGrid aria-label="Hobbies">
						<mat-chip-row
							*ngFor="let myHobby of myHobbies"
							(removed)="remove(myHobby, myHobbies)"
						>
							{{ myHobby }}
							<button
								matChipRemove
								type="button"
								[attr.aria-label]="'remove ' + myHobby"
							>
								<mat-icon>cancel</mat-icon>
							</button>
						</mat-chip-row>
						<input
							#hobbiesInput
							[formControl]="hobbyCtrl"
							[matChipInputFor]="chipGrid"
							[matAutocomplete]="auto"
							[matChipInputSeparatorKeyCodes]="separatorKeysCodes"
							(matChipInputTokenEnd)="add($event, myHobbies, hobbyCtrl)"
						/>
						<mat-autocomplete
							#auto="matAutocomplete"
							(optionSelected)="selected($event)"
						>
							<mat-option
								*ngFor="let hobby of filteredHobbies$ | async"
								[value]="hobby"
								>{{ hobby }}</mat-option
							>
						</mat-autocomplete>
					</mat-chip-grid>
				</mat-form-field>
				<mat-form-field class="example-chip-list">
					<mat-label>Linki do social media</mat-label>
					<mat-chip-grid #chipGrid2 aria-label="Social media">
						<mat-chip-row
							*ngFor="let socialMedia of socialMedias"
							[editable]="true"
							[aria-description]="'press enter to edit ' + socialMedia"
							(removed)="remove(socialMedia, socialMedias)"
							(edited)="edit(socialMedia, $event)"
						>
							{{ socialMedia }}
							<button
								matChipRemove
								type="button"
								[attr.aria-label]="'remove ' + socialMedia"
							>
								<mat-icon>cancel</mat-icon>
							</button>
						</mat-chip-row>
						<input
							placeholder="Wpisz link do social media"
							[formControl]="socialMediaCtrl"
							[matChipInputFor]="chipGrid2"
							[matChipInputSeparatorKeyCodes]="separatorKeysCodes"
							[matChipInputAddOnBlur]="addOnBlur"
							(matChipInputTokenEnd)="add($event, socialMedias, socialMediaCtrl)"
						/>
					</mat-chip-grid>
				</mat-form-field>
				<span *ngIf="!checkValidity(student.validTill)" class="btn-upload-box">
					<a *ngIf="!urlNewScan">Wczytaj skan aktualnego dokumentu!</a>
					<button
						mat-icon-button
						type="button"
						aria-label="Upload"
						matTooltip="Wczytaj skan dokumentu"
						(click)="scanUpload.click()"
					>
						<mat-icon>attachment</mat-icon>
					</button>
					<input
						#scanUpload
						id="documentScan"
						class="file-upload"
						type="file"
						accept="image/*,application/pdf"
						aria-label="File"
						(change)="onFileSelected($event, regexScan)"
					/>
					<mat-error *ngIf="!urlNewScan" class="error-text"
						>Nie wczytano skanu dokumentu!</mat-error
					>
				</span>
				<mat-form-field *ngIf="!checkValidity(student.validTill)">
					<mat-label>Dokument tożsamości</mat-label>
					<mat-select id="documentType" formControlName="documentType">
						<mat-option *ngFor="let document of documents" [value]="document">
							{{ document }}
						</mat-option>
					</mat-select>
					<mat-error
						*ngIf="dataFormGroupStudent.controls['documentType'].errors?.['required']"
						class="error-text"
					>
						Nie wybrano rodzaju dokumentu!
					</mat-error>
				</mat-form-field>
				<input
					#scanUpload
					id="documentScan"
					class="file-upload"
					type="file"
					accept="image/*,application/pdf"
					aria-label="File"
					(change)="onFileSelected($event, regexScan)"
				/>
				<mat-form-field *ngIf="!checkValidity(student.validTill)">
					<mat-label>Data ważności dokumentu</mat-label>
					<input matInput formControlName="validTill" [matDatepicker]="picker" />
					<mat-datepicker-toggle
						matIconSuffix
						[for]="picker"
					></mat-datepicker-toggle>
					<mat-datepicker #picker [startAt]="startDate"></mat-datepicker>
					<mat-error
						*ngIf="dataFormGroupStudent.controls['validTill'].errors?.['required']"
						class="error-text"
					>
						Nie określono daty ważności dokumentu!
					</mat-error>
					<mat-error
						*ngIf="dataFormGroupStudent.controls['validTill'].errors?.['validityTill']"
						class="error-text"
					>
						Termin ważności dokumentu nie może być wcześniejszy niż 14 dni!
					</mat-error>
				</mat-form-field>
				<div *ngIf="modificationType === mType.EDIT" class="btn-box">
					<button
						mat-raised-button
						color="primary"
						type="button"
						aria-label="Edit"
						(click)="changeEmail()"
					>
						Edytuj email
						<mat-icon iconPositionEnd>edit</mat-icon>
					</button>
				</div>
				<div *ngIf="modificationType === mType.EDIT" class="btn-box">
					<button
						mat-raised-button
						color="primary"
						type="button"
						aria-label="Edit"
						(click)="changePassword()"
					>
						Zmień hasło
						<mat-icon iconPositionEnd>edit</mat-icon>
					</button>
				</div>
				<div *ngIf="modificationType === mType.EDIT" class="btn-box">
					<button
						mat-raised-button
						color="primary"
						type="button"
						aria-label="Edit"
						(click)="changeSurvey()"
					>
						Edytuj ankietę
						<mat-icon iconPositionEnd>edit</mat-icon>
					</button>
				</div>
			</div>
			<div *ngIf="modificationType === mType.EDIT" class="btn-box-submit">
				<button mat-raised-button color="primary" type="submit">
					Zapisz <mat-icon iconPositionEnd>done_outline</mat-icon>
				</button>
			</div>
		</div>
	</div>
</form>
<form
	*ngIf="(user$ | async) === uType.OWNER && (actualOwner$ | async) as owner"
	[formGroup]="dataFormGroupOwner"
	(ngSubmit)="onSubmit()"
>
	<div class="edit-profile">
		<div class="container-photo">
			<div class="image-box">
				<img class="profile-avatar__image" [src]="urlPhoto" />
				<input
					#photoUpload
					id="file"
					class="file-upload"
					type="file"
					accept="image/*"
					aria-label="File"
					value="urlPhoto"
					(change)="onFileSelected($event, regexImage)"
				/>
				<mat-error *ngIf="!urlPhoto || urlPhoto === urlAvatar" class="error-text"
					>Nie wczytano zdjęcia!</mat-error
				>
				<div class="text-3xl p-4 semibold">
					{{ owner.name }} {{ owner.surname }}
				</div>
				<div class="text-3xl pb-4 semibold">
					status:
					{{ owner.status === sType.VERIFIED ? sType.VERIFIED : sType.UNVERIFIED }}
				</div>
				<div class="text-3xl pb-4 semibold">email: {{ owner.email }}</div>
				<div class="button-box">
					<button
						mat-raised-button
						id="upload"
						color="primary"
						type="button"
						aria-label="Upload"
						(click)="photoUpload.click()"
					>
						<span *ngIf="modificationType === mType.EDIT">Zmień zdjęcie</span>
						<span *ngIf="modificationType === mType.CREATE">Dodaj zdjęcie</span>
						<mat-icon iconPositionEnd>add_photo_alternate</mat-icon>
					</button>
				</div>
			</div>
		</div>
		<div class="container-inputs">
			<div class="data-container">
				<mat-form-field>
					<mat-label>Adres zamieszkania</mat-label>
					<input
						id="address"
						formControlName="address"
						type="text"
						placeholder="Adres zamieszkania"
						aria-label="Address"
						matInput
					/>
					<mat-error
						*ngIf="dataFormGroupOwner.controls['address'].errors?.['required']"
						class="error-text"
					>
						Nie podano adresu!
					</mat-error>
				</mat-form-field>
				<mat-form-field>
					<mat-label>Nr telefonu</mat-label>
					<input matInput formControlName="phoneNumber" placeholder="Nr telefonu" />
					<mat-error
						*ngIf="dataFormGroupOwner.controls['phoneNumber'].errors?.['required']"
						class="error-text"
					>
						Nie podano numeru telefonu!
					</mat-error>
					<mat-error
						*ngIf="dataFormGroupOwner.controls['phoneNumber'].errors?.['pattern']"
						class="error-text"
					>
						Nieprawidłowy numer telefonu!
					</mat-error>
				</mat-form-field>
				<mat-form-field>
					<mat-label>Nr konta bankowego</mat-label>
					<input
						matInput
						formControlName="bankAccount"
						placeholder="Nr konta bankowego"
					/>
					<mat-error
						*ngIf="dataFormGroupOwner.controls['bankAccount'].errors?.['required']"
						class="error-text"
					>
						Nie podano numeru konta bankowego!
					</mat-error>
					<mat-error
						*ngIf="dataFormGroupOwner.controls['bankAccount'].errors?.['pattern']"
						class="error-text"
					>
						Nieprawidłowy numeru konta bankowego!
					</mat-error>
				</mat-form-field>
				<span *ngIf="!checkValidity(owner.validTill)" class="btn-upload-box">
					<a *ngIf="!urlNewScan">Wczytaj skan aktualnego dokumentu!</a>
					<button
						mat-icon-button
						type="button"
						aria-label="Upload"
						matTooltip="Wczytaj skan dokumentu"
						(click)="scanUpload.click()"
					>
						<mat-icon>attachment</mat-icon>
					</button>
					<input
						#scanUpload
						id="documentScan"
						class="file-upload"
						type="file"
						accept="image/*,application/pdf"
						aria-label="File"
						(change)="onFileSelected($event, regexScan)"
					/>
					<mat-error *ngIf="!urlNewScan" class="error-text"
						>Nie wczytano skanu dokumentu!</mat-error
					>
				</span>
				<mat-form-field *ngIf="!checkValidity(owner.validTill)">
					<mat-label>Data ważności dowodu osobistego</mat-label>
					<input matInput formControlName="validTill" [matDatepicker]="picker" />
					<mat-datepicker-toggle
						matIconSuffix
						[for]="picker"
					></mat-datepicker-toggle>
					<mat-datepicker #picker></mat-datepicker>
					<mat-error
						*ngIf="dataFormGroupOwner.controls['validTill'].errors?.['required']"
						class="error-text"
					>
						Nie określono daty ważności dokumentu!
					</mat-error>
					<mat-error
						*ngIf="dataFormGroupOwner.controls['validTill'].errors?.['validityTill']"
						class="error-text"
					>
						Termin ważności dokumentu nie może być wcześniejszy niż 14 dni!
					</mat-error>
				</mat-form-field>
				<div *ngIf="modificationType === mType.EDIT" class="btn-box">
					<button
						mat-raised-button
						color="primary"
						type="button"
						aria-label="Edit"
						(click)="changeEmail()"
					>
						Edytuj email
						<mat-icon iconPositionEnd>edit</mat-icon>
					</button>
				</div>
				<div *ngIf="modificationType === mType.EDIT" class="btn-box">
					<button
						mat-raised-button
						color="primary"
						type="button"
						aria-label="Edit"
						(click)="changePassword()"
					>
						Zmień hasło
						<mat-icon iconPositionEnd>edit</mat-icon>
					</button>
				</div>
				<div *ngIf="modificationType === mType.EDIT" class="btn-box">
					<button
						mat-raised-button
						color="primary"
						type="button"
						aria-label="Edit"
						(click)="changeSurvey()"
					>
						Edytuj ankietę
						<mat-icon iconPositionEnd>edit</mat-icon>
					</button>
				</div>
			</div>
			<div *ngIf="modificationType === mType.EDIT" class="btn-box-submit">
				<button mat-raised-button color="primary" type="submit">
					Zapisz <mat-icon iconPositionEnd>done_outline</mat-icon>
				</button>
			</div>
		</div>
	</div>
</form>
