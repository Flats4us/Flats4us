<ng-template
	#modifyProfile
	let-actualForm="actualForm"
	let-actualUser="actualUser"
	let-userType="userType"
>
	<div
		*ngIf="actualUser && modificationType === mType.EDIT"
		class="container-title"
	>
		<h1 *ngIf="actualUser.userType === 1" class="text-4xl p-4 font-semibold">
			Edycja profilu studenta
		</h1>
		<h1 *ngIf="actualUser.userType === 0" class="text-4xl p-4 font-semibold">
			Edycja profilu właściciela
		</h1>
	</div>
	<form [formGroup]="actualForm" (ngSubmit)="onSubmit()">
		<div *ngIf="modificationType === mType.EDIT" class="menu-btn">
			<button
				id="menu"
				mat-mini-fab
				color="primary"
				matTooltip="Więcej opcji"
				aria-label="MenuButton"
				[matMenuTriggerFor]="menu"
			>
				<mat-icon>more_horiz</mat-icon>
			</button>
			<mat-menu #menu="matMenu" id="sort">
				<button
					*ngFor="let menuOption of this.menuOptions"
					mat-menu-item
					[value]="menuOption.description"
					[disabled]="
						actualUser.userType !== 1 && menuOption.option === 'editSurvey'
							? true
							: false
					"
					(click)="onSelect(menuOption)"
				>
					<span>{{ menuOption.description }}</span>
				</button>
			</mat-menu>
		</div>
		<div class="edit-profile">
			<div class="container-photo">
				<div class="image-box">
					<img class="profile-avatar__image" [src]="urlPhoto" />
					<input
						#photoUpload
						id="file"
						class="file-upload"
						type="file"
						accept="image/*"
						aria-label="File"
						value="urlPhoto"
						(change)="onFileSelected($event, regexImage)"
					/>
					<mat-error *ngIf="!urlPhoto || urlPhoto === urlAvatar" class="error-text"
						>Nie wczytano zdjęcia!</mat-error
					>
					<div
						*ngIf="actualUser && modificationType === mType.EDIT"
						class="text-3xl p-4 semibold"
					>
						{{ actualUser.name }} {{ actualUser.surname }}
					</div>
					<div
						*ngIf="modificationType === mType.CREATE"
						class="text-3xl p-4 semibold"
					>
						{{ name }} {{ surname }}
					</div>
					<div
						*ngIf="actualUser && modificationType === mType.EDIT"
						class="text-3xl pb-4 semibold"
					>
						status:
						{{
							actualUser.verificationStatus === 0
								? toLowerCase(sType.VERIFIED)
								: toLowerCase(sType.UNVERIFIED)
						}}
					</div>
					<div
						*ngIf="actualUser && modificationType === mType.EDIT"
						class="text-3xl pb-4 semibold"
					>
						email: {{ actualUser.email }}
					</div>
					<div
						*ngIf="modificationType === mType.CREATE"
						class="text-3xl pb-4 semibold"
					>
						email: {{ email }}
					</div>
					<div
						*ngIf="
							userType === uType.STUDENT || (actualUser && actualUser.userType === 1)
						"
					>
						<div
							*ngIf="
								actualUser &&
								modificationType === mType.EDIT &&
								getAge(actualUser.birthDate)
							"
							class="text-3xl pb-4 semibold"
						>
							wiek {{ getAge(actualUser.birthDate) }}
						</div>
						<div
							*ngIf="
								modificationType === mType.CREATE &&
								getAge(actualForm.get('birthDate')?.value)
							"
							class="text-3xl pb-4 semibold"
						>
							wiek {{ getAge(actualForm.get("birthDate")?.value ?? "") }}
						</div>
					</div>
					<div class="button-box">
						<button
							mat-raised-button
							color="primary"
							id="upload"
							type="button"
							aria-label="Upload"
							(click)="photoUpload.click()"
						>
							<span *ngIf="modificationType === mType.EDIT">Zmień zdjęcie</span>
							<span *ngIf="modificationType === mType.CREATE">Dodaj zdjęcie</span>
							<mat-icon iconPositionEnd>add_photo_alternate</mat-icon>
						</button>
					</div>
				</div>
			</div>
			<div class="container-inputs">
				<div class="data-container">
					<mat-form-field
						*ngIf="userType === uType.STUDENT && modificationType === mType.CREATE"
					>
						<mat-label>Data urodzenia</mat-label>
						<input matInput formControlName="birthDate" [matDatepicker]="picker" />
						<mat-datepicker-toggle
							matIconSuffix
							[for]="picker"
						></mat-datepicker-toggle>
						<mat-datepicker #picker [startAt]="startDate"></mat-datepicker>
						<mat-error
							*ngIf="actualForm.controls['birthDate'].errors?.['required']"
							class="error-text"
						>
							Nie określono daty urodzenia!
						</mat-error>
						<mat-error
							*ngIf="actualForm.controls['birthDate'].errors?.['validityAge']"
							class="error-text"
						>
							Podano nieprawidłową datę urodzenia!
						</mat-error>
					</mat-form-field>
					<mat-form-field
						*ngIf="
							userType === uType.STUDENT || (actualUser && actualUser.userType === 1)
						"
					>
						<mat-label>Numer studencki</mat-label>
						<input
							id="studentNumber"
							formControlName="studentNumber"
							type="text"
							placeholder="Numer studencki"
							aria-label="StudentNumber"
							matInput
						/>
						<mat-error
							*ngIf="actualForm.controls['studentNumber'].errors?.['required']"
							class="error-text"
						>
							Nie podano numeru studenta!
						</mat-error>
					</mat-form-field>
					<mat-form-field
						*ngIf="
							userType === uType.STUDENT || (actualUser && actualUser.userType === 1)
						"
					>
						<mat-label>Uczelnia</mat-label>
						<input
							id="university"
							formControlName="university"
							type="text"
							placeholder="Uczelnia"
							aria-label="University"
							matInput
						/>
						<mat-error
							*ngIf="actualForm.controls['university'].errors?.['required']"
							class="error-text"
						>
							Nie podano nazwy uczelni!
						</mat-error>
					</mat-form-field>
					<mat-form-field>
						<mat-label>Adres zamieszkania</mat-label>
						<input
							id="address"
							formControlName="address"
							type="text"
							placeholder="Adres zamieszkania"
							aria-label="Address"
							matInput
						/>
						<mat-error
							*ngIf="dataFormGroupStudent.controls['address'].errors?.['required']"
							class="error-text"
						>
							Nie podano adresu!
						</mat-error>
					</mat-form-field>
					<mat-form-field>
						<mat-label>Nr telefonu</mat-label>
						<input matInput formControlName="phoneNumber" placeholder="Nr telefonu" />
						<mat-error
							*ngIf="dataFormGroupStudent.controls['phoneNumber'].errors?.['required']"
							class="error-text"
						>
							Nie podano numeru telefonu!
						</mat-error>
						<mat-error
							*ngIf="dataFormGroupStudent.controls['phoneNumber'].errors?.['pattern']"
							class="error-text"
						>
							Nieprawidłowy numer telefonu!
						</mat-error>
					</mat-form-field>
					<mat-form-field
						*ngIf="
							userType === uType.OWNER || (actualUser && actualUser.userType === 0)
						"
					>
						<mat-label>Nr konta bankowego</mat-label>
						<input
							matInput
							formControlName="bankAccount"
							placeholder="Nr konta bankowego"
						/>
						<mat-error
							*ngIf="actualForm.controls['bankAccount'].errors?.['required']"
							class="error-text"
						>
							Nie podano numeru konta bankowego!
						</mat-error>
						<mat-error
							*ngIf="actualForm.controls['bankAccount'].errors?.['pattern']"
							class="error-text"
						>
							Nieprawidłowy numeru konta bankowego!
						</mat-error>
					</mat-form-field>
					<mat-form-field
						*ngIf="
							userType === uType.STUDENT || (actualUser && actualUser.userType === 1)
						"
					>
						<mat-label>Zainteresowania</mat-label>
						<mat-chip-grid #chipGrid aria-label="Interests">
							<mat-chip-row
								*ngFor="let myHobby of myHobbies"
								(removed)="removeHobby(myHobby, myHobbies)"
							>
								{{ myHobby.name }}
								<button
									matChipRemove
									type="button"
									[attr.aria-label]="'remove ' + myHobby.name"
								>
									<mat-icon>cancel</mat-icon>
								</button>
							</mat-chip-row>
							<input
								#hobbiesInput
								[formControl]="hobbyCtrl"
								[matChipInputFor]="chipGrid"
								[matAutocomplete]="auto"
								[matChipInputSeparatorKeyCodes]="separatorKeysCodes"
								(matChipInputTokenEnd)="addHobby($event, myHobbies, hobbyCtrl)"
							/>
							<mat-autocomplete
								#auto="matAutocomplete"
								(optionSelected)="selected($event)"
							>
								<mat-option
									*ngFor="let hobby of filteredHobbies$ | async"
									[value]="hobby"
									>{{ hobby.name }}</mat-option
								>
							</mat-autocomplete>
						</mat-chip-grid>
					</mat-form-field>
					<mat-form-field
						*ngIf="
							userType === uType.STUDENT || (actualUser && actualUser.userType === 1)
						"
						class="example-chip-list"
					>
						<mat-label>Linki do social media</mat-label>
						<mat-chip-grid #chipGrid2 aria-label="Links">
							<mat-chip-row
								*ngFor="let socialMedia of socialMedias"
								[editable]="true"
								[aria-description]="'press enter to edit ' + socialMedia"
								(removed)="removeSocialMedia(socialMedia, socialMedias)"
								(edited)="editSocialMedia(socialMedia, $event)"
							>
								{{ socialMedia }}
								<button
									matChipRemove
									type="button"
									[attr.aria-label]="'remove ' + socialMedia"
								>
									<mat-icon>cancel</mat-icon>
								</button>
							</mat-chip-row>
							<input
								placeholder="Wpisz link do social media"
								[formControl]="socialMediaCtrl"
								[matChipInputFor]="chipGrid2"
								[matChipInputSeparatorKeyCodes]="separatorKeysCodes"
								[matChipInputAddOnBlur]="addOnBlur"
								(matChipInputTokenEnd)="
									addSocialMedia($event, socialMedias, socialMediaCtrl)
								"
							/>
						</mat-chip-grid>
					</mat-form-field>
					<span
						*ngIf="
							modificationType === mType.CREATE ||
							(actualUser && !checkValidityTill(actualUser.documentExpireDate))
						"
						class="btn-upload-box"
					>
						<a *ngIf="!urlNewScan">Wczytaj skan aktualnego dokumentu!</a>
						<button
							mat-icon-button
							type="button"
							aria-label="Upload"
							matTooltip="Wczytaj skan dokumentu"
							(click)="scanUpload.click()"
						>
							<mat-icon>attachment</mat-icon>
						</button>
						<input
							#scanUpload
							id="documentScan"
							class="file-upload"
							type="file"
							accept="image/*,application/pdf"
							aria-label="File"
							(change)="onFileSelected($event, regexScan)"
						/>
						<mat-error *ngIf="!urlNewScan" class="error-text"
							>Nie wczytano skanu dokumentu!</mat-error
						>
					</span>
					<mat-form-field
						*ngIf="
							(actualUser && !checkValidityTill(actualUser.documentExpireDate)) ||
							modificationType === mType.CREATE
						"
					>
						<mat-label>Dokument tożsamości</mat-label>
						<mat-select id="documentType" formControlName="documentType">
							<mat-option
								*ngFor="let document of profileService.documentTypes"
								[value]="document.value"
								[disabled]="
									(userType === uType.OWNER ||
										(actualUser && actualUser.userType === 0)) &&
									document.value === 1
										? true
										: false
								"
							>
								{{ document.viewValue }}
							</mat-option>
						</mat-select>
						<mat-error
							*ngIf="actualForm.controls['documentType'].errors?.['required']"
							class="error-text"
						>
							Nie wybrano rodzaju dokumentu!
						</mat-error>
					</mat-form-field>
					<mat-form-field>
						<mat-label>Data ważności dokumentu</mat-label>
						<input
							matInput
							formControlName="documentExpireDate"
							[matDatepicker]="picker"
						/>
						<mat-datepicker-toggle
							matIconSuffix
							[for]="picker"
						></mat-datepicker-toggle>
						<mat-datepicker #picker [startAt]="startDate"></mat-datepicker>
						<mat-error
							*ngIf="actualForm.controls['documentExpireDate'].errors?.['required']"
							class="error-text"
						>
							Nie określono daty ważności dokumentu!
						</mat-error>
						<mat-error
							*ngIf="actualForm.controls['documentExpireDate'].errors?.['validityTill']"
							class="error-text"
						>
							Termin ważności dokumentu upłynął!
						</mat-error>
					</mat-form-field>
				</div>
				<div *ngIf="modificationType === mType.EDIT" class="btn-box-submit">
					<button mat-raised-button color="primary" type="submit">
						Zapisz <mat-icon iconPositionEnd>done_outline</mat-icon>
					</button>
				</div>
			</div>
		</div>
	</form>
</ng-template>
<div *ngIf="modificationType === mType.EDIT">
	<div *ngIf="actualUser$ | async as actualUser">
		<ng-container
			*ngIf="actualUser.userType === 1"
			[ngTemplateOutlet]="modifyProfile"
			[ngTemplateOutletContext]="{
				actualForm: dataFormGroupStudent,
				actualUser: actualUser,
				userType: user
			}"
		></ng-container>
		<ng-container
			*ngIf="actualUser.userType === 0"
			[ngTemplateOutlet]="modifyProfile"
			[ngTemplateOutletContext]="{
				actualForm: dataFormGroupOwner,
				actualUser: actualUser,
				userType: user
			}"
		></ng-container>
	</div>
</div>
<div *ngIf="modificationType === mType.CREATE">
	<ng-container
		*ngIf="user === uType.STUDENT"
		[ngTemplateOutlet]="modifyProfile"
		[ngTemplateOutletContext]="{
			actualForm: dataFormGroupStudent,
			actualUser: null,
			userType: user
		}"
	></ng-container>
	<ng-container
		*ngIf="user === uType.OWNER"
		[ngTemplateOutlet]="modifyProfile"
		[ngTemplateOutletContext]="{
			actualForm: dataFormGroupOwner,
			actualUser: null,
			userType: user
		}"
	></ng-container>
</div>
