<div
	*ngIf="{
		user: user$ | async,
		offer: actualOffer$ | async,
		show: showOffer$ | async
	} as data"
>
	<div
		*ngIf="
			(data.user !== uType.DETAILS && data.show) || data.user === uType.DETAILS
		"
		class="grid gap-4"
	>
		<mat-card>
			<div *ngIf="data.user === uType.OWNER" class="label-box">
				<mat-label class="label-description">
					<span class="text-3xl"
						>Status oferty:
						{{ offerService.offerStatuses.get(data.offer?.offerStatus ?? 0) }}
						<button
							*ngIf="data.offer?.rentPropositionToShow"
							mat-mini-fab
							class="box-icon"
							color="primary"
							matTooltip="Oferta najmu czeka na zaakceptowanie!"
							aria-label="MenuButton"
							(click)="
								onRentApproval(data.offer?.rentPropositionToShow, data.offer?.offerId)
							"
						>
							<mat-icon>notifications</mat-icon>
						</button>
						<button
							mat-mini-fab
							class="box-icon"
							color="primary"
							matTooltip="Przejdź do widoku najmu"
							aria-label="MenuButton"
							[disabled]="data.offer?.offerStatus !== 2"
							(click)="showRent(data.offer?.rentId)"
						>
							<mat-icon class="material-symbols-outlined">handshake</mat-icon>
						</button>
					</span></mat-label
				>
				<mat-label class="label-right">
					<mat-icon class="icon" inline="true">visibility</mat-icon>
					<span class="text-2xl">
						Liczba obserwujących: {{ data.offer?.numberOfInterested }}
					</span>
				</mat-label>
			</div>
			<div class="gallery">
				<div class="container slider">
					<div [@slideAnimation]="currentIndex">
						<ng-template
							ngFor
							[ngForOf]="data.offer?.property?.images"
							let-slide
							let-i="index"
						>
							<div class="offer-title-outer">
								<span class="offer-title-inner"
									><h1 class="text-3xl">
										Wynajem -
										{{
											realEstateService.propertyTypes.get(
												data.offer?.property?.propertyType ?? 0
											)
										}}
										{{ data.offer?.property?.area }} m² {{ data.offer?.property?.city }}
									</h1>
								</span>
							</div>
							<div
								*ngIf="data.user === uType.OWNER || data.user === uType.STUDENT"
								class="menu-title"
							>
								<button
									class="box-icon"
									id="menu"
									mat-mini-fab
									color="primary"
									matTooltip="Więcej opcji"
									aria-label="MenuButton"
									[matMenuTriggerFor]="menu"
									[disabled]="
										data?.offer?.offerStatus === 2 || data?.offer?.offerStatus === 3
									"
								>
									<mat-icon>more_horiz</mat-icon>
								</button>
								<mat-menu #menu="matMenu" id="options">
									<button
										*ngFor="let menuOption of this.menuOptions"
										mat-menu-item
										[value]="menuOption.description"
										[disabled]="
											(data.offer?.isPromoted && menuOption.option === 'promoteOffer') ||
											(data.offer?.offerStatus !== 0 && menuOption.option === 'closeOffer')
										"
										(click)="
											onSelect(
												menuOption,
												data?.offer?.offerId,
												data.offer?.property?.propertyId
											)
										"
									>
										<div
											class="flex items-center justify-center"
											[ngSwitch]="menuOption.option"
											[ngClass]="menuOption.option === 'closeOffer' ? 'close-offer' : ''"
										>
											<mat-icon
												*ngSwitchCase="'offerDetails'"
												class="material-icons-outlined"
												>info</mat-icon
											>
											<mat-icon
												*ngSwitchCase="'promoteOffer'"
												class="material-icons-outlined"
												>new_releases</mat-icon
											>
											<mat-icon *ngSwitchCase="'property'" class="material-icons-outlined"
												>real_estate_agent</mat-icon
											>
											<mat-icon
												*ngSwitchCase="'closeOffer'"
												class="material-icons-outlined"
												>close</mat-icon
											>
											<span>{{ menuOption.description }}</span>
										</div>
									</button>
								</mat-menu>
							</div>
							<div *ngIf="data.user === uType.DETAILS" class="menu-title">
								<button
									*appAccessControl="authService.allPermissions.get('verifiedStudent')"
									mat-mini-fab
									class="ml-auto"
									id="addToWatched"
									type="button"
									color="primary"
									matTooltip="Dodaj do obserwowanych"
									aria-label="AddToWatched"
									[disabled]="data.offer?.isInterest"
									(click)="addToWatched(data.offer?.offerId)"
								>
									<mat-icon>favorite_border</mat-icon>
								</button>
							</div>
							<img
								*ngIf="
									(data.offer?.property?.images?.length ?? 0) > 0 &&
									isCurrentSlideIndex(i)
								"
								class="slide slide-animation non-draggable-image"
								src="{{ baseUrl }}/{{ slide.path }}"
								(swiperight)="nextSlide(data.offer?.property?.images?.length)"
								(swipeleft)="prevSlide(data.offer?.property?.images?.length)"
							/>
						</ng-template>
					</div>

					<button
						class="arrow prev"
						(click)="nextSlide(data.offer?.property?.images?.length)"
					>
						<mat-icon>arrow_back_ios</mat-icon>
					</button>
					<button
						class="arrow next"
						(click)="prevSlide(data.offer?.property?.images?.length)"
					>
						<mat-icon>arrow_forward_ios</mat-icon>
					</button>
					<nav class="nav">
						<div class="wrapper">
							<ul class="dots">
								<li
									*ngFor="let slide of data.offer?.property?.images; let i = index"
									class="dot"
								>
									<span
										[ngClass]="{ active: isCurrentSlideIndex(i) }"
										(click)="setCurrentSlideIndex(i)"
									></span>
								</li>
							</ul>
						</div>
					</nav>
				</div>
			</div>
			<div class="button-box">
				<mat-label class="label-survey">
					<span>
						<mat-chip
							class="p-4 mr-4"
							matTooltip="{{
								data.offer?.property?.avgRating
									? 'Zobacz szczegółową ocenę'
									: 'Nieruchomość nie została jeszcze oceniona'
							}}"
							(click)="showRating(data.offer?.property)"
						>
							<div class="flex items-center">
								<app-star-rating [avgRating]="data.offer?.property?.avgRating ?? 0">
								</app-star-rating>
							</div>
						</mat-chip>
					</span>
					<span [ngSwitch]="data.offer?.surveyOwnerOffer?.smokingAllowed">
						<mat-chip *ngSwitchCase="false" class="p-4 mr-4">
							<div class="text-red-600 flex items-center justify-center">
								<mat-icon matTooltip="Palenie niedozwolone">smoke_free</mat-icon>
							</div>
						</mat-chip>
						<mat-chip *ngSwitchCase="true" class="p-4 mr-4">
							<div class="flex items-center justify-center">
								<mat-icon matTooltip="Palenie dozwolone">smoking_rooms</mat-icon>
							</div>
						</mat-chip>
					</span>
					<span [ngSwitch]="data.offer?.surveyOwnerOffer?.animalsAllowed">
						<mat-chip *ngSwitchCase="false" class="p-4 mr-4">
							<div class="text-red-600 flex items-center justify-center">
								<mat-icon matTooltip="Zwierzęta niedozwolone">pets</mat-icon>
							</div>
						</mat-chip>
						<mat-chip *ngSwitchCase="true" class="p-4 mr-4">
							<div class="flex items-center justify-center">
								<mat-icon matTooltip="Zwierzęta dozwolone">pets</mat-icon>
							</div>
						</mat-chip>
					</span>
					<span [ngSwitch]="data.offer?.surveyOwnerOffer?.partiesAllowed">
						<mat-chip *ngSwitchCase="false" class="p-4 mr-4">
							<div class="text-red-600 flex items-center justify-center">
								<mat-icon matTooltip="Imprezy niedozwolone">celebration</mat-icon>
							</div>
						</mat-chip>
						<mat-chip *ngSwitchCase="true" class="p-4 mr-4">
							<div class="flex items-center justify-center">
								<mat-icon matTooltip="Imprezy dozwolone">celebration</mat-icon>
							</div>
						</mat-chip>
					</span>
				</mat-label>
				<mat-label class="label-right">
					<mat-icon class="icon" inline="true"> sell </mat-icon>
					<span class="text-3xl"
						>Cena
						{{ data.offer?.price | currency : "PLN" : true : ".2-2" }}/mies.</span
					></mat-label
				>
			</div>
		</mat-card>
		<mat-card>
			<div class="label-box">
				<mat-label class="label-description"
					><mat-icon class="icon" inline="true">description</mat-icon
					><span class="text-3xl">Opis oferty</span></mat-label
				>
				<mat-label *ngIf="data.offer?.isPromoted" class="label-right">
					<mat-icon class="icon-promo" inline="true">new_releases</mat-icon>
					<span class="text-3xl">Oferta promowana</span></mat-label
				>
			</div>
			<mat-divider></mat-divider>
			<div class="container-description">
				<div class="column-header-description">
					<p class="text-2xl pt-4">Kaucja:</p>
					<p class="text-2xl pt-4">Data wystawienia:</p>
					<p class="text-2xl pt-4">Data zakończenia:</p>
					<p class="text-2xl pt-4">Miasto:</p>
					<p class="text-2xl pt-4">Kod pocztowy:</p>
					<p class="text-2xl pt-4">Ulica:</p>
					<p class="text-2xl pt-4">Metraż:</p>
					<p class="text-2xl pt-4">Liczba pokoi:</p>
					<p class="text-2xl pt-4">Liczba pięter:</p>
					<p class="text-2xl pt-4">Piętro:</p>
					<p class="text-2xl pt-4">Maks. l. lokatorów:</p>
					<p class="text-2xl pt-4">Rok budowy:</p>
					<p class="text-2xl pt-4">Informacje o umowie:</p>
					<p class="text-2xl pt-4">Wyposażenie:</p>
				</div>
				<div class="column-header-description">
					<p class="text-2xl pt-4">
						{{ data.offer?.deposit | currency : "PLN" : true : ".2-2" }}
					</p>
					<p class="text-2xl pt-4">{{ data.offer?.startDate | date }}</p>
					<p class="text-2xl pt-4">{{ data.offer?.endDate | date }}</p>
					<p class="text-2xl pt-4">{{ data.offer?.property?.city }}</p>
					<p class="text-2xl pt-4">{{ data.offer?.property?.postalCode }}</p>
					<p class="text-2xl pt-4">
						{{ data.offer?.property?.street }} {{ data.offer?.property?.number }}
					</p>
					<p class="text-2xl pt-4">{{ data.offer?.property?.area }} m²</p>
					<p class="text-2xl pt-4">
						{{
							data.offer?.property?.numberOfRooms === null
								? "-"
								: data.offer?.property?.numberOfRooms
						}}
					</p>
					<p class="text-2xl pt-4">
						{{
							data.offer?.property?.numberOfFloors === null
								? "-"
								: data.offer?.property?.numberOfFloors
						}}
					</p>
					<p class="text-2xl pt-4">
						{{
							data.offer?.property?.floor === null ? "-" : data.offer?.property?.floor
						}}
					</p>
					<p class="text-2xl pt-4">
						{{
							data.offer?.property?.maxNumberOfInhabitants === null
								? "-"
								: data.offer?.property?.maxNumberOfInhabitants
						}}
					</p>
					<p class="text-2xl pt-4">{{ data.offer?.property?.constructionYear }}</p>
					<p class="text-2xl pt-4">{{ data.offer?.regulations }}</p>
					<p class="text-2xl pt-4">
						<span *ngFor="let equipment of data?.offer?.property?.equipment"
							><mat-chip class="mr-4" [ngSwitch]="equipment.equipmentId">
								<div *ngSwitchCase="1" class="box-equipment">
									<span class="material-symbols-outlined">dishwasher</span>
									<span>{{ equipment.name }}</span>
								</div>
								<div *ngSwitchCase="2" class="box-equipment">
									<mat-icon>local_laundry_service</mat-icon
									><span>{{ equipment.name }}</span>
								</div>
								<div *ngSwitchCase="3" class="box-equipment">
									<mat-icon>iron</mat-icon><span>{{ equipment.name }}</span>
								</div>
								<div *ngSwitchCase="4" class="box-equipment">
									<span class="material-symbols-outlined">kettle</span>
									<span>{{ equipment.name }}</span>
								</div>
								<div *ngSwitchCase="5" class="box-equipment">
									<mat-icon>coffee_maker</mat-icon><span>{{ equipment.name }}</span>
								</div>
								<div *ngSwitchCase="6" class="box-equipment">
									<mat-icon>ac_unit</mat-icon><span>{{ equipment.name }}</span>
								</div>
								<div *ngSwitchCase="7" class="box-equipment">
									<mat-icon>balcony</mat-icon><span>{{ equipment.name }}</span>
								</div>
								<div *ngSwitchCase="8" class="box-equipment">
									<mat-icon>tv</mat-icon><span>{{ equipment.name }}</span>
								</div>
								<div *ngSwitchCase="9" class="box-equipment">
									<mat-icon>bathtub</mat-icon><span>{{ equipment.name }}</span>
								</div>
								<div *ngSwitchCase="10" class="box-equipment">
									<span class="material-symbols-outlined">oven</span>
									<span>{{ equipment.name }}</span>
								</div>
								<div *ngSwitchCase="11" class="box-equipment">
									<mat-icon>microwave</mat-icon><span>{{ equipment.name }}</span>
								</div>
								<div *ngSwitchCase="12" class="box-equipment">
									<mat-icon>elevator</mat-icon><span>{{ equipment.name }}</span>
								</div>
								<div *ngSwitchDefault class="box-equipment">
									<mat-icon>devices</mat-icon><span>{{ equipment.name }}</span>
								</div>
							</mat-chip>
						</span>
					</p>
				</div>
			</div>
		</mat-card>
		<div *ngIf="data.user === uType.DETAILS" class="button-box-options">
			<button mat-raised-button color="primary" (click)="returnStart()">
				Powrót
			</button>
			<button
				*appAccessControl="authService.allPermissions.get('verifiedStudent')"
				mat-raised-button
				color="primary"
				(click)="onAddMeeting(data.offer?.offerId)"
			>
				Dodaj spotkanie
			</button>
			<button
				*appAccessControl="authService.allPermissions.get('verifiedStudent')"
				mat-raised-button
				color="primary"
				[disabled]="data.offer?.offerStatus !== 0"
				(click)="startRent(data.offer?.offerId)"
			>
				Wynajmij
			</button>
		</div>
	</div>
</div>
